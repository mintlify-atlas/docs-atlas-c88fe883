---
title: "Ingest PDF Policy"
api: "POST /api/policies/ingest"
description: "Upload a PDF policy document and extract compliance rules using Gemini AI"
---

## Overview

This endpoint accepts a PDF policy document, extracts its text content, and uses Google's Gemini AI to automatically identify and extract actionable compliance rules. The extracted rules are saved to a new policy with all associated rules.

## Authentication

Requires a valid session token. Returns `401 UNAUTHORIZED` if not authenticated.

## Request

<ParamField body="file" type="file" required>
  PDF file to upload. Must be a valid, non-encrypted PDF with extractable text. Scanned image PDFs without OCR will be rejected.
</ParamField>

### Content Type

`multipart/form-data`

### Example Request

```bash
curl -X POST https://yourdomain.com/api/policies/ingest \
  -H "Cookie: session=your_session_token" \
  -F "file=@compliance-policy.pdf"
```

## Response

<ResponseField name="policy" type="object">
  The created policy with extracted rules
  
  <ResponseField name="id" type="string">
    UUID of the created policy
  </ResponseField>
  
  <ResponseField name="name" type="string">
    Policy name (extracted from PDF or filename)
  </ResponseField>
  
  <ResponseField name="rules" type="array">
    Array of extracted compliance rules
    
    <ResponseField name="rule_id" type="string">
      Unique rule identifier in UPPER_SNAKE_CASE (e.g., `DATA_RETENTION_VIOLATION`)
    </ResponseField>
    
    <ResponseField name="name" type="string">
      Human-readable rule name
    </ResponseField>
    
    <ResponseField name="description" type="string">
      Detailed description of the rule
    </ResponseField>
    
    <ResponseField name="type" type="string">
      Rule category (e.g., `retention`, `encryption`, `access_control`, `consent`)
    </ResponseField>
    
    <ResponseField name="severity" type="enum">
      Rule severity level: `CRITICAL`, `HIGH`, or `MEDIUM`
    </ResponseField>
    
    <ResponseField name="threshold" type="number | null">
      Numeric threshold for threshold-based rules (e.g., 10000 for amount limits)
    </ResponseField>
    
    <ResponseField name="time_window" type="number | null">
      Time window in hours for temporal rules
    </ResponseField>
    
    <ResponseField name="conditions" type="object">
      Rule evaluation logic using recursive AND/OR conditions. Each leaf condition has `field`, `operator`, and `value`.
      
      Supported operators: `equals`, `not_equals`, `greater_than`, `less_than`, `greater_than_or_equal`, `less_than_or_equal`, `contains`, `exists`, `not_exists`, `IN`, `BETWEEN`, `MATCH` (regex)
    </ResponseField>
    
    <ResponseField name="policy_excerpt" type="string">
      Exact quote from the PDF justifying this rule
    </ResponseField>
    
    <ResponseField name="policy_section" type="string">
      Section reference from the policy document
    </ResponseField>
    
    <ResponseField name="requires_clarification" type="boolean">
      Whether the rule requires additional clarification
    </ResponseField>
    
    <ResponseField name="clarification_notes" type="string">
      Notes explaining what needs clarification
    </ResponseField>
  </ResponseField>
  
  <ResponseField name="created_at" type="string">
    ISO 8601 timestamp of policy creation
  </ResponseField>
</ResponseField>

### Success Response

```json
{
  "policy": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "name": "GDPR Data Protection Policy",
    "rules": [
      {
        "rule_id": "DATA_RETENTION_VIOLATION",
        "name": "Data Retention Limit Exceeded",
        "description": "Personal data retained beyond maximum allowed period",
        "type": "retention",
        "severity": "HIGH",
        "threshold": null,
        "time_window": 8760,
        "conditions": {
          "AND": [
            {
              "field": "data_type",
              "operator": "equals",
              "value": "personal"
            },
            {
              "field": "retention_days",
              "operator": "greater_than",
              "value": 365
            }
          ]
        },
        "policy_excerpt": "Personal data must not be retained for longer than 12 months unless explicitly required by law.",
        "policy_section": "Article 5.1.e",
        "requires_clarification": false
      }
    ],
    "created_at": "2026-02-28T10:30:00Z"
  }
}
```

## Error Responses

<ResponseField name="error" type="string">
  Error code identifier
</ResponseField>

<ResponseField name="message" type="string">
  Human-readable error message
</ResponseField>

### 400 Bad Request

```json
{
  "error": "VALIDATION_ERROR",
  "message": "No PDF file provided"
}
```

```json
{
  "error": "VALIDATION_ERROR",
  "message": "Failed to parse PDF. Ensure the file is a valid, non-encrypted PDF."
}
```

```json
{
  "error": "VALIDATION_ERROR",
  "message": "PDF contains no extractable text. It may be a scanned image."
}
```

### 401 Unauthorized

```json
{
  "error": "UNAUTHORIZED",
  "message": "Authentication required"
}
```

### 500 Internal Server Error

```json
{
  "error": "INTERNAL_ERROR",
  "message": "An unexpected error occurred"
}
```

## Rule Extraction Logic

The Gemini AI model uses a **Signal Specificity Framework** to ensure high-precision rules:

- **Weak Signals (0.5)**: Single thresholds, basic state checks
- **Medium Signals (1.0)**: Temporal windows, behavioral shifts
- **Strong Signals (2.0)**: Multiple conditions, cross-field comparisons

All extracted rules must achieve a combined specificity score of â‰¥2.0 to minimize false positives.

## Processing Limits

- Maximum PDF text size: 500,000 characters
- Larger documents are truncated
- Gemini 2.0 Flash supports up to ~1M tokens (~4M characters)

## Notes

- PDF parsing uses the `unpdf` library with fallback to UTF-8 text decoding
- Rules are automatically assigned UUIDs and associated with the policy
- All rules are set to `is_active: true` by default
- The policy type is set to `pdf` to distinguish from prebuilt policies